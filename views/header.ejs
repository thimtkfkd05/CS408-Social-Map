<meta name="google-signin-scope" content="profile https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.readonly">
<meta name="google-signin-client_id" content="468607746966-bqb4r002gsu8oavgsn2igh5hntoa295j.apps.googleusercontent.com">
<script src="https://apis.google.com/js/platform.js"></script>
<script src="https://apis.google.com/js/client.js"></script>
<script>
    gapi.load('client:auth2', function() {
        gapi.client.init({
            apiKey: 'AIzaSyBVhAysUuLePfYO9EKf-de-XBfzU2Vg1fk',
            clientId: '468607746966-bqb4r002gsu8oavgsn2igh5hntoa295j.apps.googleusercontent.com',
            scope: 'profile https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.readonly'
        }).then(function() {
            gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
            updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        });
    });
    function updateSigninStatus(status) {
        if (status) {
            $('#login').hide();
            $('#logout').show();
        } else {
            $('#logout').hide();
            $('#login').show();
        }
    };
    function onSignIn(googleUser) {};
    $(window).on('load', function() {
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        $(document).on('click', '#login', function() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signIn().then(function() {
                var googleUser = auth2.currentUser.get();
                var auth = googleUser.getAuthResponse();
                var profile = googleUser.getBasicProfile();
                $.post('/auth/google_user', {
                    id: profile.getId(),
                    name: profile.getName(),
                    email: profile.getEmail(),
                    id_token: auth.id_token,
                    access_token: auth.access_token
                }, function(result) {
                    updateSigninStatus(result && auth2.isSignedIn.get());
                    location.reload(); 
                });
            });
        });

        $(document).on('click', '#logout', function() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function() {
                updateSigninStatus(auth2.isSignedIn.get());
                $.post('/auth/google_user/logout', {}, function(err) {
                    location.reload();
                });
            });
        });
    });
</script>
<div id="header">
    <div class="col-xs-1"></div>
	<div class="container col-xs-10">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-target="#header-navbar" data-toggle="collapse" aria-contral="header-navbar" aria-expanded="false">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a href="/calendar" class="navbar-brand">Join</a>
		</div>
		<nav id="header-navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-menu">
				<li>
					<a href="/calendar"><i class="fa fa-calendar-o"></i> Calendar</a>
				</li>
				<li>
					<a href="/events"><i class="fa fa-search-plus"></i> Events</a>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li>
                    <a id="login"><i class="fa fa-user-o"></i> Login</a>
                    <a id="logout" style="display: none;"><i class="fa fa-user-o"></i> Logout</a>
				    <div class="g-signin2" data-onsuccess="onSignIn" style="display: none;"></div>
                </li>
				<li>
					<a href=""><i class="fa fa-cog"></i> Settings</a>
				</li>
			</ul>
		</nav>
	</div>
    <div class="col-xs-1"></div>
</div>
